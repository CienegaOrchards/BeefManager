<!DOCTYPE html>
<html>
<head>
    <% include include/jquery-header.ejs %>
    <% include include/parse-header.ejs %>
    <% include include/cienegacss.ejs %>
    <% var moment = require('moment'); %>
    <title>Inventory</title>
</head>
<body>
    <div id='menu'></div>

    <div id='content'>
        <table summary="Prices of meats">
            <thead><tr><th>Species</th><th>Category</th><th>Cut</th><th>Qty</th><th>Price</th><th>Location</th><th>Freezer</th><th>Slaughtered</th></tr></thead></thead>
            <tbody>
                <%
                var prev_species='', prev_cat = '', prev_cut = '';
                meats.forEach(function(meat) {
                    var cut = meat.get('cut');
                    var freezer = meat.get('freezer');
                    var animal = meat.get('animal');
                    %>
                    <tr>
                        <td><% if(cut.get('species') != prev_species) { prev_species = cut.get('species') %><%= prev_species %><% } %></td>
                        <td><% if(cut.get('category') != prev_cat) { prev_cat = cut.get('category') %><%= prev_cat === undefined ? '' : prev_cat %><% } %></td>
                        <td><% if(cut.get('cut') != prev_cut) { prev_cut = cut.get('cut') %><%= prev_cut === undefined ? '' : prev_cut %><% } %></td>
                        <td><span class='aligndecimals'><%= meat.get('units').toFixed(2) %></span><span style='float:right;'>&nbsp;<%= cut.get('units') %></span></td>
                        <td><span style='float:left;'>$</span> <span class='aligndecimals'><%= (meat.get('units') * cut.get('price')).toFixed(2) %></span></td>
                        <td><span class='location'><%= freezer === undefined ? meat.get('location') : freezer.get('location') %></span></td>
                        <td><%= freezer === undefined ? '' : freezer.get('identifier') %></td>
                        <td><%= animal === undefined ? '' : moment(animal.get('slaughtered')).fromNow() %></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>

    <% include include/jquery-scripts.ejs %>
    <% include include/parse-scripts.ejs %>

</body>
</html>
